# TallyConnector Migration Tests

This project contains migration tests that compare XML serialization output between:
- **Current Approach**: `TallyXml.GetXML()` using `System.Xml.Serialization.XmlSerializer`
- **New Approach**: XmlSourceGenerator using compile-time source generation

## Project Structure

```
TallyConnector.MigrationTests/
├─ Infrastructure/
│  └─ SerializationComparer.cs     # XML comparison utilities
├─ Models/
│  └─ TestModels.cs                # Test models with dual attributes
├─ Tests/
│  ├─ BasicTypesSerializationTests.cs
│  ├─ AttributeMappingTests.cs
│  ├─ CollectionSerializationTests.cs
│  └─ RealWorldModelTests.cs
└─ TallyConnector.MigrationTests.csproj
```

## Test Models

All test models inherit from `TallyXml` and are decorated with **both**:
- `System.Xml.Serialization` attributes (for current approach)
- `SourceGeneratorUtils` attributes (for XmlSourceGenerator)

Example:
```csharp
[SysXml.XmlRoot(ElementName = "COMPANY")]
[XmlRoot("COMPANY")]
[XmlSourceGenerator.Abstractions.XmlAutoGenerated]
public partial class TestCompany : TallyXml
{
    [SysXml.XmlElement(ElementName = "NAME")]
    [XmlElement("NAME")]
    public string? Name { get; set; }
}
```

## Test Approach

Each test:
1. Creates a test model instance with sample data
2. Serializes using `GetXML()` (current approach)
3. Serializes using `WriteToXml()` (generated approach)
4. Compares XML outputs semantically
5. Asserts equivalence

## Running Tests

```bash
cd \\saivineeth\d\SourceCode\AccountingCompanion\TallyConnector_New\src\Tests\TallyConnector.MigrationTests
dotnet test
```

## Test Coverage

- ✅ Basic types (string, int, decimal, bool, DateTime)
- ✅ Nullable types
- ✅ XML attributes vs elements
- ✅ Collections (List, Array)
- ✅ Nested objects
- ✅ Real-world models (Company, Voucher with LedgerEntries)
